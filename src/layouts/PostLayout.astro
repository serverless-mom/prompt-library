---
import BaseLayout from './BaseLayout.astro';

export interface Props {
  title: string;
  description?: string;
  author?: string;
  image?: string;
  tags?: string[];
}

const { title, description, author, image, tags = [] } = Astro.props;
const base = import.meta.env.BASE_URL.endsWith('/') ? import.meta.env.BASE_URL : import.meta.env.BASE_URL + '/';
---

<BaseLayout title={title} description={description} image={image}>
  <article>
    <h1 class="post-title">{title}</h1>
    
    {(author || tags.length > 0) && (
      <div class="post-meta">
        {author && (
          <span class="post-author">{author}</span>
        )}
        {tags.length > 0 && (
          <span class="post-tags">
            {tags.map((tag) => (
              <span class="tag">{tag}</span>
            ))}
          </span>
        )}
      </div>
    )}
    
    {image && (
      <figure class="post-cover">
        <img src={image} alt={title} />
      </figure>
    )}
    
    <div class="post-content">
      <slot />
    </div>
  </article>
  
  <script>
    // Code copy functionality
    document.addEventListener('DOMContentLoaded', () => {
      const codeBlocks = document.querySelectorAll('pre.astro-code');
      
      codeBlocks.forEach((block) => {
        const wrapper = document.createElement('div');
        wrapper.className = 'highlight';
        block.parentNode?.insertBefore(wrapper, block);
        wrapper.appendChild(block);
        
        const lang = block.getAttribute('data-language') || 'text';
        
        const titleDiv = document.createElement('div');
        titleDiv.className = 'code-title';

        
        if (navigator.clipboard) {
          const button = document.createElement('button');
          button.className = 'copy-button';
          button.textContent = 'Copy';
          
          button.addEventListener('click', async () => {
            const code = block.textContent || '';
            try {
              await navigator.clipboard.writeText(code);
              button.textContent = 'Copied';
              setTimeout(() => {
                button.textContent = 'Copy';
              }, 1000);
            } catch (err) {
              console.error('Failed to copy:', err);
            }
          });
          
          titleDiv.appendChild(button);
        }
        
        wrapper.insertBefore(titleDiv, block);
      });
    });
  </script>
  
</BaseLayout>